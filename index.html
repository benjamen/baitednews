<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dynamic Post Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      align-items: start;
    }

    .controls {
      background: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 15px;
      backdrop-filter: blur(10px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    .controls h2 {
      margin-top: 0;
      color: #333;
      font-size: 24px;
      margin-bottom: 25px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #555;
    }

    input,
    textarea,
    select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s ease;
      box-sizing: border-box;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: #667eea;
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    .preview {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #svgPreview {
      background: white;
      border-radius: 15px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      max-width: 100%;
      height: auto;
    }

    .download-btn {
      margin-top: 20px;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      max-width: 200px;
    }

    @media (max-width: 768px) {
      .container {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .controls {
        padding: 20px;
      }

      #svgPreview {
        width: 100% !important;
        height: auto !important;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="controls">
      <h2>ðŸŽ¨ Dynamic Post Generator</h2>
      <div class="form-group">
        <label for="heading">Main Heading:</label>
        <textarea id="heading">$2.3M TOILETS FOR WELLINGTON WITH "DIVERSE LIGHTING"</textarea>
      </div>
      <div class="form-group">
        <label for="category">Category:</label>
        <input type="text" id="category" value="CULTURE" />
      </div>
      <div class="form-group">
        <label for="author">Author:</label>
        <input type="text" id="author" value="muddoogan" />
      </div>
      <div class="form-group">
        <label for="bgUpload">Background Image:</label>
        <input type="file" id="bgUpload" accept="image/*" />
      </div>
    </div>
    <div class="preview">
      <svg id="svgPreview" width="800" height="800" viewBox="0 0 800 800"></svg>
      <button class="download-btn" onclick="downloadPNG()">Download PNG</button>
    </div>
  </div>

  <script>
    let logoDataUrl = '';
    fetch('baitedlogowhite.png')
      .then(res => res.blob())
      .then(blob => {
        const reader = new FileReader();
        reader.onload = () => { logoDataUrl = reader.result; generateSVG(); };
        reader.readAsDataURL(blob);
      });

    let backgroundDataUrl = '';
    document.getElementById('bgUpload').addEventListener('change', function(e) {
      const reader = new FileReader();
      reader.onload = () => { backgroundDataUrl = reader.result; generateSVG(); };
      reader.readAsDataURL(e.target.files[0]);
    });

    function wrapText(text, maxWidth = 680, fontSize = 60) {
      const words = text.split(' ');
      let lines = [], line = '';
      const maxCharsPerLine = Math.floor(maxWidth / (fontSize * 0.55));
      words.forEach(word => {
        if ((line + word).length <= maxCharsPerLine) {
          line += (line ? ' ' : '') + word;
        } else {
          lines.push(line);
          line = word;
        }
      });
      if (line) lines.push(line);
      return lines;
    }

    function generateSVG() {
      const heading = document.getElementById('heading').value;
      const category = document.getElementById('category').value;
      const author = document.getElementById('author').value;

      const lines = wrapText(heading);
      let y = 280;
      let headlineText = lines.map(line =>
        `<text x="400" y="${y += 64}" font-size="60" font-family="Arial" fill="white" font-weight="bold" text-anchor="middle">${line}</text>`
      ).join('');

      const categoryWidth = category.length * 12 + 40;

      let svg = `
        <svg xmlns="http://www.w3.org/2000/svg" width="800" height="800">
        ${backgroundDataUrl ? `<image href="${backgroundDataUrl}" x="0" y="0" width="800" height="800" preserveAspectRatio="none"/>` : `<rect width="800" height="800" fill="#ccc"/>`}
        <rect width="800" height="120" fill="white" opacity="0.5"/>
        <rect x="${800 - categoryWidth - 40}" y="30" width="${categoryWidth}" height="50" rx="8" fill="#ffff00"/>
        <text x="${800 - categoryWidth / 2 - 40}" y="60" font-size="20" font-weight="bold" font-family="Arial" text-anchor="middle">${category}</text>
        ${logoDataUrl ? `<image href="${logoDataUrl}" x="40" y="20" width="100" height="100" preserveAspectRatio="xMidYMid meet"/>` : ''}
        ${headlineText}
        <rect y="720" width="800" height="80" fill="black"/>
        <text x="400" y="760" font-size="18" font-family="Arial" fill="white" font-weight="bold" text-anchor="middle">
          ${author} <tspan fill="#f36">| @baitednews</tspan>
        </text>
        </svg>
      `;

      document.getElementById('svgPreview').innerHTML = svg;
    }

    function downloadPNG() {
      const svgElement = document.getElementById('svgPreview');
      const svgContent = svgElement.innerHTML;
      const fullSVG = `<svg xmlns='http://www.w3.org/2000/svg' width='800' height='800'>${svgContent}</svg>`;
      const svgBlob = new Blob([fullSVG], { type: 'image/svg+xml;charset=utf-8' });
      const url = URL.createObjectURL(svgBlob);

      const img = new Image();
      img.onload = function() {
        const canvas = document.createElement('canvas');
        canvas.width = 800;
        canvas.height = 800;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0);
        URL.revokeObjectURL(url);
        canvas.toBlob(function(blob) {
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = 'baited-post.png';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
        });
      };
      img.onerror = function() {
        alert('Failed to render PNG image. Please try again.');
      };
      img.src = url;
    }

    document.querySelectorAll('input, textarea').forEach(input => {
      input.addEventListener('input', generateSVG);
    });

    generateSVG();
  </script>
</body>
</html>
