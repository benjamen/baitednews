<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dynamic Post Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      align-items: start;
    }

    .controls {
      background: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 15px;
      backdrop-filter: blur(10px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    .controls h2 {
      margin-top: 0;
      color: #333;
      font-size: 24px;
      margin-bottom: 25px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #555;
    }

    input,
    textarea,
    select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s ease;
      box-sizing: border-box;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: #667eea;
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    .preview {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #svgPreview {
      background: white;
      border-radius: 15px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      max-width: 100%;
      height: auto;
    }

    .download-btn {
      margin-top: 20px;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      max-width: 200px;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .download-btn:hover {
      transform: translateY(-2px);
    }

    @media (max-width: 768px) {
      .container {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .controls {
        padding: 20px;
      }

      #svgPreview {
        width: 100% !important;
        height: auto !important;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="controls">
      <h2>ðŸŽ¨ Dynamic Post Generator</h2>
      <div class="form-group">
        <label for="heading">Main Heading:</label>
        <textarea id="heading">$2.3M TOILETS FOR WELLINGTON WITH "DIVERSE LIGHTING"</textarea>
      </div>
      <div class="form-group">
        <label for="category">Category:</label>
        <input type="text" id="category" value="CULTURE" />
      </div>
      <div class="form-group">
        <label for="author">Author:</label>
        <input type="text" id="author" value="muddoogan" />
      </div>
      <div class="form-group">
        <label for="bgUpload">Background Image:</label>
        <input type="file" id="bgUpload" accept="image/*" />
      </div>
    </div>
    <div class="preview">
      <svg id="svgPreview" width="800" height="800" viewBox="0 0 800 800"></svg>
      <button class="download-btn" onclick="downloadPNG()">Download PNG</button>
    </div>
  </div>

  <script>
    let logoDataUrl = '';
    
    // Try to read the uploaded logo file
    async function loadLogo() {
      try {
        const logoData = await window.fs.readFile('logotrans.png');
        const blob = new Blob([logoData], { type: 'image/png' });
        const reader = new FileReader();
        reader.onload = () => { 
          logoDataUrl = reader.result; 
          generateSVG(); 
        };
        reader.readAsDataURL(blob);
      } catch (error) {
        console.log('Logo file not found, continuing without logo');
        generateSVG();
      }
    }
    
    loadLogo();

    let backgroundDataUrl = '';
    document.getElementById('bgUpload').addEventListener('change', function(e) {
      const reader = new FileReader();
      reader.onload = () => { backgroundDataUrl = reader.result; generateSVG(); };
      reader.readAsDataURL(e.target.files[0]);
    });

    function wrapText(text, maxCharsPerLine = 12) {
      const words = text.split(' ');
      const lines = [];
      let currentLine = '';
      
      words.forEach(word => {
        // If a single word is too long, break it up
        if (word.length > maxCharsPerLine) {
          // Add current line if it exists
          if (currentLine) {
            lines.push(currentLine);
            currentLine = '';
          }
          
          // Break the long word into chunks
          for (let i = 0; i < word.length; i += maxCharsPerLine) {
            lines.push(word.slice(i, i + maxCharsPerLine));
          }
        } else {
          const testLine = currentLine + (currentLine ? ' ' : '') + word;
          if (testLine.length <= maxCharsPerLine) {
            currentLine = testLine;
          } else {
            if (currentLine) {
              lines.push(currentLine);
              currentLine = word;
            } else {
              lines.push(word);
              currentLine = '';
            }
          }
        }
      });
      
      if (currentLine) {
        lines.push(currentLine);
      }
      
      return lines;
    }

    function generateSVG() {
      const heading = document.getElementById('heading').value;
      const category = document.getElementById('category').value;
      const author = document.getElementById('author').value;

      // Wrap text with balanced character limit 
      const lines = wrapText(heading, 18); // Reduced from 25 to 18 characters per line
      let y = 200; // Start higher to accommodate header
      
      let headlineText = lines.map(line => {
        y += 70; // Line height
        return `<text x="400" y="${y}" font-size="60" font-family="Arial, sans-serif" fill="white" font-weight="bold" text-anchor="middle" stroke="rgba(0,0,0,0.3)" stroke-width="1">${line}</text>`;
      }).join('');

      const categoryWidth = category.length * 12 + 40;

      let svg = `
        <svg xmlns="http://www.w3.org/2000/svg" width="800" height="800">
        ${backgroundDataUrl ? `<image href="${backgroundDataUrl}" x="0" y="0" width="800" height="800" preserveAspectRatio="xMidYMid slice"/>` : `<rect width="800" height="800" fill="#ccc"/>`}
        
        <!-- Header background -->
        <rect width="800" height="120" fill="rgba(255,255,255,0.9)"/>
        
        <!-- Category badge - aligned with logo -->
        <rect x="${800 - categoryWidth - 40}" y="35" width="${categoryWidth}" height="50" rx="25" fill="#ffff00"/>
        <text x="${800 - categoryWidth / 2 - 40}" y="65" font-size="18" font-weight="bold" font-family="Arial, sans-serif" text-anchor="middle" fill="#333">${category}</text>
        
        <!-- Logo - aligned horizontally with category, 50% bigger -->
        ${logoDataUrl ? `<image href="${logoDataUrl}" x="40" y="22.5" width="75" height="75" preserveAspectRatio="xMidYMid meet"/>` : ''}
        
        <!-- Headline text with proper margins -->
        ${headlineText}
        
        <!-- Footer -->
        <rect y="720" width="800" height="80" fill="rgba(0,0,0,0.8)"/>
        <text x="400" y="760" font-size="18" font-family="Arial, sans-serif" fill="white" font-weight="bold" text-anchor="middle">
          ${author} <tspan fill="#ff4d6d">| @baitednews</tspan>
        </text>
        </svg>
      `;

      document.getElementById('svgPreview').innerHTML = svg;
    }

    function downloadPNG() {
      const svgElement = document.getElementById('svgPreview');
      const svgContent = svgElement.innerHTML;
      const fullSVG = `<svg xmlns='http://www.w3.org/2000/svg' width='800' height='800'>${svgContent}</svg>`;
      const svgBlob = new Blob([fullSVG], { type: 'image/svg+xml;charset=utf-8' });
      const url = URL.createObjectURL(svgBlob);

      const img = new Image();
      img.onload = function() {
        const canvas = document.createElement('canvas');
        canvas.width = 800;
        canvas.height = 800;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0);
        URL.revokeObjectURL(url);
        canvas.toBlob(function(blob) {
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = 'baited-post.png';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(a.href);
        });
      };
      img.onerror = function() {
        alert('Failed to render PNG image. Please try again.');
        URL.revokeObjectURL(url);
      };
      img.src = url;
    }

    document.querySelectorAll('input, textarea').forEach(input => {
      input.addEventListener('input', generateSVG);
    });

    generateSVG();
  </script>
</body>
</html>
